-- DziÄ™ki indeksowi Unique na qr_code, czas wyszukiwania jest pomijalny
SELECT r.id, u.full_name
FROM rentals r
JOIN inventory_items i ON r.inventory_item_id = i.id
JOIN users u ON r.user_id = u.id
WHERE i.qr_code = 'XYZ-123-456' AND r.status = 'ACTIVE';


-- Zapytanie optymalizowane indeksem B-Tree na kolumnie 'title'
SELECT m.title, i.qr_code, i.location
FROM movies m
JOIN inventory_items i ON m.id = i.movie_id
WHERE m.title ILIKE 'Incepcja%' AND i.status = 'AVAILABLE';



-- Zapytanie kluczowe dla procesu zwrotu.
-- Wykorzystuje Unique Index na 'qr_code', co skraca czas wyszukiwania do milisekund.
SELECT r.id, u.full_name, r.due_at
FROM rentals r
JOIN inventory_items i ON r.inventory_item_id = i.id
JOIN users u ON r.user_id = u.id
WHERE i.qr_code = 'QR-882-991-X' AND r.status = 'ACTIVE';


--zwaraca najpopularniejsze filmy -- 
SELECT g.name, COUNT(r.id) as total_rentals
FROM genres g
JOIN movie_genres mg ON g.id = mg.genre_id
JOIN movies m ON mg.movie_id = m.id
JOIN inventory_items i ON m.id = i.movie_id
JOIN rentals r ON i.id = r.inventory_item_id
GROUP BY g.name
ORDER BY total_rentals DESC
LIMIT 5;