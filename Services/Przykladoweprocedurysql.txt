-- procedura wyliczajÄ…ca kary --
CREATE OR REPLACE PROCEDURE calculate_penalties()
LANGUAGE plpgsql AS $$
BEGIN
    UPDATE rentals
    SET price = price + 5.00
    WHERE status = 'ACTIVE' AND due_at < CURRENT_TIMESTAMP;
END;
$$;

-- Automatyczne zmiana statusu kopii
CREATE OR REPLACE FUNCTION fn_mark_item_as_rented()
RETURNS TRIGGER AS $$
BEGIN
    UPDATE inventory_items
    SET status = 'RENTED'
    WHERE id = NEW.inventory_item_id;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_after_rental_insert
AFTER INSERT ON rentals
FOR EACH ROW
EXECUTE FUNCTION fn_mark_item_as_rented();



